<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="tool" content="leanote-desktop-app">
<title>spring4.0整合了validation验证功能</title>
<style>

*{font-family:"lucida grande","lucida sans unicode",lucida,helvetica,"Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;}

body {
  margin: 0;
}

/*公用文字样式*/
h1{font-size:30px}h2{font-size:24px}h3{font-size:18px}h4{font-size:14px}
.note-container{
    width:850px; 
    margin:auto;
    padding: 10px 20px;
    box-shadow: 1px 1px 10px #eee;
}
#title {
  margin: 0;
}
table {
    margin-bottom: 16px;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #ddd;
}
table th {
    font-weight: bold;
}

table tr {
    background-color: none;
    border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
    background-color: rgb(247, 247, 249);
}
.mce-item-table, .mce-item-table td, .mce-item-table th, .mce-item-table caption {
  border: 1px solid #ddd;
  border-collapse: collapse;
  padding: 6px 13px;
}
blockquote {
  border-left-width:10px;
  background-color:rgba(128,128,128,0.05);
  border-top-right-radius:5px;
  border-bottom-right-radius:5px;
  padding:15px 20px;
  border-left:5px solid rgba(128,128,128,0.075);
}
blockquote p {
  margin-bottom:1.1em;
  font-size:1em;
  line-height:1.45
}
blockquote ul:last-child,blockquote ol:last-child {
  margin-bottom:0
}
pre {
  padding: 18px;
  background-color: #f7f7f9;
  border: 1px solid #e1e1e8;
  border-radius: 3px;
  display: block;
}
code {
  padding: 2px 4px;
  font-size: 90%;
  color: #c7254e;
  white-space: nowrap;
  background-color: #f9f2f4;
  border-radius: 4px;
}
.footnote {
  vertical-align: top;
  position: relative;
  top: -0.5em;
  font-size: .8em;
}

hr {
  margin:2em 0
}
img {
  max-width:100%
}
pre {
  word-break:break-word
}
p,pre,pre.prettyprint,blockquote {
  margin:0 0 1.1em
}
hr {
  margin:2em 0
}
img {
  max-width:100%
}
.sequence-diagram,.flow-chart {
  text-align:center;
  margin-bottom:1.1em
}
.sequence-diagram text,.flow-chart text {
  font-size:15px !important;
  font-family:"Source Sans Pro",sans-serif !important
}
.sequence-diagram [fill="#ffffff"],.flow-chart [fill="#ffffff"] {
  fill:#f6f6f6
}
.sequence-diagram [stroke="#000000"],.flow-chart [stroke="#000000"] {
  stroke:#3f3f3f
}
.sequence-diagram text[stroke="#000000"],.flow-chart text[stroke="#000000"] {
  stroke:none
}
.sequence-diagram [fill="#000"],.flow-chart [fill="#000"],.sequence-diagram [fill="#000000"],.flow-chart [fill="#000000"],.sequence-diagram [fill="black"],.flow-chart [fill="black"] {
  fill:#3f3f3f
}
ul,ol {
  margin-bottom:1.1em
}
ul ul,ol ul,ul ol,ol ol {
  margin-bottom:1.1em
}
kbd {
  padding:.1em .6em;
  border:1px solid rgba(63,63,63,0.25);
  -webkit-box-shadow:0 1px 0 rgba(63,63,63,0.25);
  box-shadow:0 1px 0 rgba(63,63,63,0.25);
  font-size:.7em;
  font-family:sans-serif;
  background-color:#fff;
  color:#333;
  border-radius:3px;
  display:inline-block;
  margin:0 .1em;
  white-space:nowrap
}
.toc ul {
  list-style-type:none;
  margin-bottom:15px
}
</style>
<!-- 该css供自定义样式 -->
<link href="../leanote-html.css" rel="stylesheet">
<script type="text/javascript" src="../js/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="../js/show-main.js"></script>
</head>

<body>

	<div class="note-container">
		<h1 class="title" id="leanote-title">spring4.0整合了validation验证功能</h1>
		<div class="content-html" id="leanote-content"><div class="article_title"></div><div id="article_content" class="article_content tracking-ad" data-mod="popu_307" data-dsm="post"><p>今天翻译博客时 无意中发现的小知识点,</p><p>源地址:http://jinnianshilongnian.iteye.com/blog/1990081?page=2#comments</p><p>&nbsp;</p><p>Bean Validation 1.1当前实现是<a class="replace_word" title="Java EE知识库" href="http://lib.csdn.net/base/javaee" target="_blank" data-mce-href="http://lib.csdn.net/base/javaee">hibernate</a>&nbsp;validator 5，且spring4才支持。接下来我们从以下几个方法讲解Bean Validation 1.1，当然不一定是新特性：</p><ol><li>&nbsp;集成Bean Validation 1.1到SpringMVC</li><li>&nbsp;分组验证、分组顺序及级联验证</li><li>&nbsp;消息中使用EL表达式</li><li>&nbsp;方法参数/返回值验证</li><li>&nbsp;自定义验证规则</li><li>&nbsp;类级别验证器</li><li>&nbsp;脚本验证器</li><li>&nbsp;cross-parameter，跨参数验证</li><li>混合类级别验证器和跨参数验证器</li><li>组合多个验证注解</li><li>本地化</li></ol><p>因为大多数时候验证都配合web框架使用，而且很多朋友都咨询过如分组/跨参数验证，所以本文介绍下这些，且是和SpringMVC框架集成的例子，其他使用方式（比如集成到JPA中）可以参考其官方文档：</p><p>规范：<a href="http://beanvalidation.org/1.1/spec/" target="_blank" data-mce-href="http://beanvalidation.org/1.1/spec/">http://beanvalidation.org/1.1/spec/</a></p><p>hibernate validator文档：<a href="http://hibernate.org/validator/" target="_blank" data-mce-href="http://hibernate.org/validator/">http://hibernate.org/validator/</a>&nbsp;</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t0"></a>&nbsp;1、集成Bean Validation 1.1到SpringMVC</h2><p>1.1、项目搭建</p><p>首先添加hibernate validator 5依赖：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435818" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>&lt;dependency&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.hibernate&lt;/groupId&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;<span class="number">5.0</span>.<span class="number">2</span>.Final&lt;/version&gt;&nbsp;&nbsp;</li><li>&lt;/dependency&gt;&nbsp;&nbsp;</li></ol></div><p>如果想在消息中使用EL表达式，请确保EL表达式版本是&nbsp;2.2或以上，如使用Tomcat6，请到Tomcat7中拷贝相应的EL jar包到Tomcat6中。</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435819" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>&lt;dependency&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;javax.el&lt;/groupId&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;javax.el-api&lt;/artifactId&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;<span class="number">2.2</span>.<span class="number">4</span>&lt;/version&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;scope&gt;provided&lt;/scope&gt;&nbsp;&nbsp;</li><li>&lt;/dependency&gt;&nbsp;&nbsp;</li></ol></div><p>请确保您使用的Web容器有相应版本的el jar包。</p><p>&nbsp;</p><p>对于其他POM依赖请下载附件中的项目参考。</p><p>&nbsp;</p><p>1.2、<a class="replace_word" title="Java EE知识库" href="http://lib.csdn.net/base/javaee" target="_blank" data-mce-href="http://lib.csdn.net/base/javaee">spring</a>&nbsp;MVC配置文件（spring-mvc.xml）：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435820" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>&lt;!--&nbsp;指定自己定义的validator&nbsp;--&gt;&nbsp;&nbsp;</li><li>&lt;mvc:annotation-driven&nbsp;validator=<span class="string">"validator"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&lt;!--&nbsp;以下&nbsp;validator&nbsp;&nbsp;ConversionService&nbsp;在使用&nbsp;mvc:annotation-driven&nbsp;会&nbsp;自动注册--&gt;&nbsp;&nbsp;</li><li>&lt;bean&nbsp;id=<span class="string">"validator"</span>&nbsp;<span class="keyword">class</span>=<span class="string">"org.springframework.validation.beanvalidation.LocalValidatorFactoryBean"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"providerClass"</span>&nbsp;value=<span class="string">"org.hibernate.validator.HibernateValidator"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;如果不加默认到&nbsp;使用classpath下的&nbsp;ValidationMessages.properties&nbsp;--&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"validationMessageSource"</span>&nbsp;ref=<span class="string">"messageSource"</span>/&gt;&nbsp;&nbsp;</li><li>&lt;/bean&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&lt;!--&nbsp;国际化的消息资源文件（本系统中主要用于显示/错误消息定制）&nbsp;--&gt;&nbsp;&nbsp;</li><li>&lt;bean&nbsp;id=<span class="string">"messageSource"</span>&nbsp;<span class="keyword">class</span>=<span class="string">"org.springframework.context.support.ReloadableResourceBundleMessageSource"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"basenames"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;list&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;在web环境中一定要定位到classpath&nbsp;否则默认到当前web应用下找&nbsp;&nbsp;--&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;classpath:messages&lt;/value&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;classpath:org/hibernate/validator/ValidationMessages&lt;/value&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/list&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/property&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"useCodeAsDefaultMessage"</span>&nbsp;value=<span class="string">"false"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"defaultEncoding"</span>&nbsp;value=<span class="string">"UTF-8"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"cacheSeconds"</span>&nbsp;value=<span class="string">"60"</span>/&gt;&nbsp;&nbsp;</li><li>&lt;/bean&gt;&nbsp;&nbsp;</li></ol></div><p>此处主要把bean validation的消息查找委托给spring的messageSource。</p><p>&nbsp;</p><p>1.3、实体验证注解：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435821" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;User&nbsp;<span class="keyword">implements</span>&nbsp;Serializable&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@NotNull</span>(message&nbsp;=&nbsp;<span class="string">"{user.id.null}"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;Long&nbsp;id;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@NotEmpty</span>(message&nbsp;=&nbsp;<span class="string">"{user.name.null}"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Length</span>(min&nbsp;=&nbsp;<span class="number">5</span>,&nbsp;max&nbsp;=&nbsp;<span class="number">20</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.length.illegal}"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Pattern</span>(regexp&nbsp;=&nbsp;<span class="string">"[a-zA-Z]{5,20}"</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.illegal}"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;name;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@NotNull</span>(message&nbsp;=&nbsp;<span class="string">"{user.password.null}"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;password;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>对于验证规则可以参考官方文档，或者《<a href="http://jinnianshilongnian.iteye.com/blog/1733708" target="_blank" data-mce-href="http://jinnianshilongnian.iteye.com/blog/1733708">第七章 注解式控制器的数据验证、类型转换及格式化</a>》。</p><p>&nbsp;</p><p>1.4、错误消息文件messages.properties：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435822" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>user.id.<span class="keyword">null</span>=用户编号不能为空&nbsp;&nbsp;</li><li>user.name.<span class="keyword">null</span>=用户名不能为空&nbsp;&nbsp;</li><li>user.name.length.illegal=用户名长度必须在<span class="number">5</span>到<span class="number">20</span>之间&nbsp;&nbsp;</li><li>user.name.illegal=用户名必须是字母&nbsp;&nbsp;</li><li>user.password.<span class="keyword">null</span>=密码不能为空&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>1.5、控制器</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435823" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@Controller</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;UserController&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@RequestMapping</span>(<span class="string">"/save"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;String&nbsp;save(<span class="annotation">@Valid</span>&nbsp;User&nbsp;user,&nbsp;BindingResult&nbsp;result)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(result.hasErrors())&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="string">"error"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="string">"success"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>1.6、错误页面：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435824" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>&lt;spring:hasBindErrors&nbsp;name=<span class="string">"user"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;c:<span class="keyword">if</span>&nbsp;test=<span class="string">"${errors.fieldErrorCount&nbsp;&gt;&nbsp;0}"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;字段错误：&lt;br/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;c:forEach&nbsp;items=<span class="string">"${errors.fieldErrors}"</span>&nbsp;var=<span class="string">"error"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;spring:message&nbsp;var=<span class="string">"message"</span>&nbsp;code=<span class="string">"${error.code}"</span>&nbsp;arguments=<span class="string">"${error.arguments}"</span>&nbsp;text=<span class="string">"${error.defaultMessage}"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${error.field}------${message}&lt;br/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/c:forEach&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/c:<span class="keyword">if</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;c:<span class="keyword">if</span>&nbsp;test=<span class="string">"${errors.globalErrorCount&nbsp;&gt;&nbsp;0}"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;全局错误：&lt;br/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;c:forEach&nbsp;items=<span class="string">"${errors.globalErrors}"</span>&nbsp;var=<span class="string">"error"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;spring:message&nbsp;var=<span class="string">"message"</span>&nbsp;code=<span class="string">"${error.code}"</span>&nbsp;arguments=<span class="string">"${error.arguments}"</span>&nbsp;text=<span class="string">"${error.defaultMessage}"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;c:<span class="keyword">if</span>&nbsp;test=<span class="string">"${not&nbsp;empty&nbsp;message}"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;${message}&lt;br/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/c:<span class="keyword">if</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/c:forEach&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/c:<span class="keyword">if</span>&gt;&nbsp;&nbsp;</li><li>&lt;/spring:hasBindErrors&gt;&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>大家以后可以根据这个做通用的错误消息显示规则。比如我前端页面使用validationEngine显示错误消息，那么我可以定义一个tag来通用化错误消息的显示：<a href="https://github.com/zhangkaitao/es/blob/master/web/src/main/webapp/WEB-INF/tags/showFieldError.tag" target="_blank" data-mce-href="https://github.com/zhangkaitao/es/blob/master/web/src/main/webapp/WEB-INF/tags/showFieldError.tag">showFieldError.tag</a>。&nbsp;&nbsp;</p><p>&nbsp;</p><p>1.7、<a class="replace_word" title="软件测试知识库" href="http://lib.csdn.net/base/softwaretest" target="_blank" data-mce-href="http://lib.csdn.net/base/softwaretest">测试</a></p><p>输入如：<a href="http://localhost:9080/spring4/save?name=123" target="_blank" data-mce-href="http://localhost:9080/spring4/save?name=123">http://localhost:9080/spring4/save?name=123</a>&nbsp;， 我们得到如下错误：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435825" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>name------用户名必须是字母&nbsp;&nbsp;</li><li>name------用户名长度必须在<span class="number">5</span>到<span class="number">20</span>之间&nbsp;&nbsp;</li><li>password------密码不能为空&nbsp;&nbsp;</li><li>id------用户编号不能为空&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>基本的集成就完成了。</p><p>&nbsp;</p><p>如上测试有几个小问题：</p><p>1、错误消息顺序，大家可以看到name的错误消息顺序不是按照书写顺序的，即不确定；</p><p>2、我想显示如：用户名【zhangsan】必须在5到20之间；其中我们想动态显示：用户名、min，max；而不是写死了；</p><p>3、我想在修改的时候只验证用户名，其他的不验证怎么办。</p><p>接下来我们挨着试试吧。</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t1"></a>2、分组验证及分组顺序</h2><p>如果我们想在新增的情况验证id和name，而修改的情况验证name和password，怎么办？ 那么就需要分组了。</p><p>首先定义分组接口：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435826" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">public</span>&nbsp;<span class="keyword">interface</span>&nbsp;First&nbsp;{&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">interface</span>&nbsp;Second&nbsp;{&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>分组接口就是两个普通的接口，用于标识，类似于<a class="replace_word" title="Java 知识库" href="http://lib.csdn.net/base/java" target="_blank" data-mce-href="http://lib.csdn.net/base/java">Java</a>.io.Serializable。</p><p>&nbsp;</p><p>接着我们使用分组接口标识实体：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435827" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;User&nbsp;<span class="keyword">implements</span>&nbsp;Serializable&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@NotNull</span>(message&nbsp;=&nbsp;<span class="string">"{user.id.null}"</span>,&nbsp;groups&nbsp;=&nbsp;{First.<span class="keyword">class</span>})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;Long&nbsp;id;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Length</span>(min&nbsp;=&nbsp;<span class="number">5</span>,&nbsp;max&nbsp;=&nbsp;<span class="number">20</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.length.illegal}"</span>,&nbsp;groups&nbsp;=&nbsp;{Second.<span class="keyword">class</span>})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Pattern</span>(regexp&nbsp;=&nbsp;<span class="string">"[a-zA-Z]{5,20}"</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.illegal}"</span>,&nbsp;groups&nbsp;=&nbsp;{Second.<span class="keyword">class</span>})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;name;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@NotNull</span>(message&nbsp;=&nbsp;<span class="string">"{user.password.null}"</span>,&nbsp;groups&nbsp;=&nbsp;{First.<span class="keyword">class</span>,&nbsp;Second.<span class="keyword">class</span>})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;password;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>验证时使用如：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435828" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@RequestMapping</span>(<span class="string">"/save"</span>)&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;String&nbsp;save(<span class="annotation">@Validated</span>({Second.<span class="keyword">class</span>})&nbsp;User&nbsp;user,&nbsp;BindingResult&nbsp;result)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(result.hasErrors())&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="string">"error"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="string">"success"</span>;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>即通过@Validate注解标识要验证的分组；如果要验证两个的话，可以这样@Validated({First.class, Second.class})。</p><p>&nbsp;</p><p>接下来我们来看看通过分组来指定顺序；还记得之前的错误消息吗？ user.name会显示两个错误消息，而且顺序不确定；如果我们先验证一个消息；如果不通过再验证另一个怎么办？可以通过@GroupSequence指定分组验证顺序：</p><p>&nbsp;</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435829" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@GroupSequence</span>({First.<span class="keyword">class</span>,&nbsp;Second.<span class="keyword">class</span>,&nbsp;User.<span class="keyword">class</span>})&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;User&nbsp;<span class="keyword">implements</span>&nbsp;Serializable&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;Long&nbsp;id;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Length</span>(min&nbsp;=&nbsp;<span class="number">5</span>,&nbsp;max&nbsp;=&nbsp;<span class="number">20</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.length.illegal}"</span>,&nbsp;groups&nbsp;=&nbsp;{First.<span class="keyword">class</span>})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Pattern</span>(regexp&nbsp;=&nbsp;<span class="string">"[a-zA-Z]{5,20}"</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.illegal}"</span>,&nbsp;groups&nbsp;=&nbsp;{Second.<span class="keyword">class</span>})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;name;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;password;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>通过@GroupSequence指定验证顺序：先验证First分组，如果有错误立即返回而不会验证Second分组，接着如果First分组验证通过了，那么才去验证Second分组，最后指定User.class表示那些没有分组的在最后。这样我们就可以实现按顺序验证分组了。</p><p>&nbsp;</p><p>另一个比较常见的就是级联验证：</p><p>如：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435830" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;User&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Valid</span>&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@ConvertGroup</span>(from=First.<span class="keyword">class</span>,&nbsp;to=Second.<span class="keyword">class</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;Organization&nbsp;o;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;1、级联验证只要在相应的字段上加@Valid即可，会进行级联验证；@ConvertGroup的作用是当验证o的分组是First时，那么验证o的分组是Second，即分组验证的转换。</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t2"></a>3、消息中使用EL表达式</h2><p>假设我们需要显示如：用户名[NAME]长度必须在[MIN]到[MAX]之间，此处大家可以看到，我们不想把一些数据写死，如NAME、MIN、MAX；此时我们可以使用EL表达式。</p><p>&nbsp;</p><p>如：</p><div class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435831" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@Length</span>(min&nbsp;=&nbsp;<span class="number">5</span>,&nbsp;max&nbsp;=&nbsp;<span class="number">20</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.length.illegal}"</span>,&nbsp;groups&nbsp;=&nbsp;{First.<span class="keyword">class</span>})&nbsp;&nbsp;</li></ol></div><p>错误消息：</p><div class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435832" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>user.name.length.illegal=用户名长度必须在{min}到{max}之间&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>其中我们可以使用{验证注解的属性}得到这些值；如{min}得到@Length中的min值；其他的也是类似的。</p><p>&nbsp;</p><p>到此，我们还是无法得到出错的那个输入值，如name=zhangsan。此时就需要EL表达式的支持，首先确定引入EL jar包且版本正确。然后使用如：</p><div class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435833" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>user.name.length.illegal=用户名[${validatedValue}]长度必须在<span class="number">5</span>到<span class="number">20</span>之间&nbsp;&nbsp;</li></ol></div><p>使用如EL表达式：${validatedValue}得到输入的值，如zhangsan。当然我们还可以使用如${min &gt; 1 ? '大于1' : '小于等于1'}，及在EL表达式中也能拿到如@Length的min等数据。</p><p>&nbsp;</p><p>另外我们还可以拿到一个java.util.Formatter类型的formatter变量进行格式化：</p><div class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435834" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>${formatter.format(<span class="string">"%04d"</span>,&nbsp;min)}&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t3"></a>4、方法参数/返回值验证</h2><p>这个可以参考《<a href="http://jinnianshilongnian.iteye.com/blog/1495594" target="_blank" data-mce-href="http://jinnianshilongnian.iteye.com/blog/1495594">Spring3.1 对Bean Validation规范的新支持(方法级别验证)</a>&nbsp;》，概念是类似的，具体可以参考Bean Validation 文档。</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t4"></a>5、自定义验证规则</h2><p>有时候默认的规则可能还不够，有时候还需要自定义规则，比如屏蔽关键词验证是非常常见的一个功能，比如在发帖时帖子中不允许出现admin等关键词。</p><p>&nbsp;</p><p>1、定义验证注解</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435835" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.Constraint;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.Payload;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Documented;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Retention;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Target;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;<span class="keyword">static</span>&nbsp;java.lang.annotation.ElementType.*;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;<span class="keyword">static</span>&nbsp;java.lang.annotation.RetentionPolicy.*;&nbsp;&nbsp;</li><li><span class="comment">/**</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;User:&nbsp;Zhang&nbsp;Kaitao</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;Date:&nbsp;13-12-15</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;Version:&nbsp;1.0</span>&nbsp;</li><li><span class="comment">&nbsp;*/</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="annotation">@Target</span>({&nbsp;FIELD,&nbsp;METHOD,&nbsp;PARAMETER,&nbsp;ANNOTATION_TYPE&nbsp;})&nbsp;&nbsp;</li><li><span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li><span class="comment">//指定验证器</span>&nbsp;&nbsp;</li><li><span class="annotation">@Constraint</span>(validatedBy&nbsp;=&nbsp;ForbiddenValidator.<span class="keyword">class</span>)&nbsp;&nbsp;</li><li><span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">@interface</span>&nbsp;Forbidden&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//默认错误消息</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">"{forbidden.word}"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//分组</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt;[]&nbsp;groups()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//负载</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&nbsp;<span class="keyword">extends</span>&nbsp;Payload&gt;[]&nbsp;payload()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//指定多个时使用</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Target</span>({&nbsp;FIELD,&nbsp;METHOD,&nbsp;PARAMETER,&nbsp;ANNOTATION_TYPE&nbsp;})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">@interface</span>&nbsp;List&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Forbidden[]&nbsp;value();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>2、 定义验证器</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435836" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.hibernate.validator.internal.engine.constraintvalidation.ConstraintValidatorContextImpl;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.springframework.beans.factory.annotation.Autowired;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.springframework.context.ApplicationContext;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.springframework.util.StringUtils;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.ConstraintValidator;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.ConstraintValidatorContext;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.io.Serializable;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="comment">/**</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;User:&nbsp;Zhang&nbsp;Kaitao</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;Date:&nbsp;13-12-15</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;Version:&nbsp;1.0</span>&nbsp;</li><li><span class="comment">&nbsp;*/</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;ForbiddenValidator&nbsp;<span class="keyword">implements</span>&nbsp;ConstraintValidator&lt;Forbidden,&nbsp;String&gt;&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String[]&nbsp;forbiddenWords&nbsp;=&nbsp;{<span class="string">"admin"</span>};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">void</span>&nbsp;initialize(Forbidden&nbsp;constraintAnnotation)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//初始化，得到注解数据</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">boolean</span>&nbsp;isValid(String&nbsp;value,&nbsp;ConstraintValidatorContext&nbsp;context)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(StringUtils.isEmpty(value))&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">true</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>(String&nbsp;word&nbsp;:&nbsp;forbiddenWords)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(value.contains(word))&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;<span class="comment">//验证失败</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">true</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;验证器中可以使用spring的依赖注入，如注入：@Autowired&nbsp; private ApplicationContext ctx;&nbsp;</p><p>&nbsp;</p><p>3、使用</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435837" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;User&nbsp;<span class="keyword">implements</span>&nbsp;Serializable&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Forbidden</span>()&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;name;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>4、当我们在提交name中含有admin的时候会输出错误消息：</p><div class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435838" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>forbidden.word=您输入的数据中有非法关键词&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>问题来了，哪个词是非法的呢？bean validation 和 hibernate validator都没有提供相应的api提供这个数据，怎么办呢？通过跟踪代码，发现一种不是特别好的方法：我们可以覆盖org.hibernate.validator.internal.metadata.descriptor.ConstraintDescriptorImpl实现（即复制一份代码放到我们的src中），然后覆盖buildAnnotationParameterMap方法；</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435839" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">private</span>&nbsp;Map&lt;String,&nbsp;Object&gt;&nbsp;buildAnnotationParameterMap(Annotation&nbsp;annotation)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;……&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//将Collections.unmodifiableMap(&nbsp;parameters&nbsp;);替换为如下语句</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;parameters;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;即允许这个数据可以修改；然后在ForbiddenValidator中：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435840" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">for</span>(String&nbsp;word&nbsp;:&nbsp;forbiddenWords)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(value.contains(word))&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((ConstraintValidatorContextImpl)context).getConstraintDescriptor().getAttributes().put(<span class="string">"word"</span>,&nbsp;word);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;<span class="comment">//验证失败</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>通过((ConstraintValidatorContextImpl)context).getConstraintDescriptor().getAttributes().put("word", word);添加自己的属性；放到attributes中的数据可以通过${}&nbsp;获取。然后消息就可以变成：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435841" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>forbidden.word=您输入的数据中有非法关键词【{word}】&nbsp;&nbsp;</li></ol></div><p>这种方式不是很友好，但是可以解决我们的问题。</p><p>&nbsp;</p><p>典型的如密码、确认密码的场景，非常常用；如果没有这个功能我们需要自己写代码来完成；而且经常重复自己。接下来看看bean validation 1.1如何实现的。</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t5"></a>6、类级别验证器</h2><p>6.1、定义验证注解</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435842" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.Constraint;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.Payload;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.constraints.NotNull;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Documented;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Retention;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Target;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;<span class="keyword">static</span>&nbsp;java.lang.annotation.ElementType.*;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;<span class="keyword">static</span>&nbsp;java.lang.annotation.RetentionPolicy.*;&nbsp;&nbsp;</li><li><span class="comment">/**</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;User:&nbsp;Zhang&nbsp;Kaitao</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;Date:&nbsp;13-12-15</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;Version:&nbsp;1.0</span>&nbsp;</li><li><span class="comment">&nbsp;*/</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="annotation">@Target</span>({&nbsp;TYPE,&nbsp;ANNOTATION_TYPE})&nbsp;&nbsp;</li><li><span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li><span class="comment">//指定验证器</span>&nbsp;&nbsp;</li><li><span class="annotation">@Constraint</span>(validatedBy&nbsp;=&nbsp;CheckPasswordValidator.<span class="keyword">class</span>)&nbsp;&nbsp;</li><li><span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">@interface</span>&nbsp;CheckPassword&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//默认错误消息</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">""</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//分组</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt;[]&nbsp;groups()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//负载</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&nbsp;<span class="keyword">extends</span>&nbsp;Payload&gt;[]&nbsp;payload()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//指定多个时使用</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Target</span>({&nbsp;FIELD,&nbsp;METHOD,&nbsp;PARAMETER,&nbsp;ANNOTATION_TYPE&nbsp;})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">@interface</span>&nbsp;List&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CheckPassword[]&nbsp;value();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>6.2、 定义验证器</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435843" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;com.sishuok.spring4.entity.User;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.springframework.util.StringUtils;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.ConstraintValidator;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.ConstraintValidatorContext;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="comment">/**</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;User:&nbsp;Zhang&nbsp;Kaitao</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;Date:&nbsp;13-12-15</span>&nbsp;</li><li><span class="comment">&nbsp;*&nbsp;&lt;p&gt;Version:&nbsp;1.0</span>&nbsp;</li><li><span class="comment">&nbsp;*/</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;CheckPasswordValidator&nbsp;<span class="keyword">implements</span>&nbsp;ConstraintValidator&lt;CheckPassword,&nbsp;User&gt;&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">void</span>&nbsp;initialize(CheckPassword&nbsp;constraintAnnotation)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">boolean</span>&nbsp;isValid(User&nbsp;user,&nbsp;ConstraintValidatorContext&nbsp;context)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(user&nbsp;==&nbsp;<span class="keyword">null</span>)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">true</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//没有填密码</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!StringUtils.hasText(user.getPassword()))&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.disableDefaultConstraintViolation();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.buildConstraintViolationWithTemplate(<span class="string">"{password.null}"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addPropertyNode(<span class="string">"password"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addConstraintViolation();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(!StringUtils.hasText(user.getConfirmation()))&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.disableDefaultConstraintViolation();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.buildConstraintViolationWithTemplate(<span class="string">"{password.confirmation.null}"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addPropertyNode(<span class="string">"confirmation"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addConstraintViolation();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//两次密码不一样</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(!user.getPassword().trim().equals(user.getConfirmation().trim()))&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.disableDefaultConstraintViolation();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.buildConstraintViolationWithTemplate(<span class="string">"{password.confirmation.error}"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addPropertyNode(<span class="string">"confirmation"</span>)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addConstraintViolation();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">true</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>其中我们通过disableDefaultConstraintViolation禁用默认的约束；然后通过buildConstraintViolationWithTemplate(消息模板)/addPropertyNode(所属属性)/addConstraintViolation定义我们自己的约束。</p><p>&nbsp;</p><p>6.3、使用</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435844" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@CheckPassword</span>()&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;User&nbsp;<span class="keyword">implements</span>&nbsp;Serializable&nbsp;{&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;放到类头上即可。</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t6"></a>7、通过脚本验证</h2><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435845" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@ScriptAssert</span>(script&nbsp;=&nbsp;<span class="string">"_this.password==_this.confirmation"</span>,&nbsp;lang&nbsp;=&nbsp;<span class="string">"javascript"</span>,&nbsp;alias&nbsp;=&nbsp;<span class="string">"_this"</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{password.confirmation.error}"</span>)&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;User&nbsp;<span class="keyword">implements</span>&nbsp;Serializable&nbsp;{&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>通过脚本验证是非常简单而且强大的，lang指定脚本语言（请参考javax.script.ScriptEngineManager JSR-223），alias是在脚本验证中User对象的名字，但是大家会发现一个问题：错误消息怎么显示呢？ 在springmvc 中会添加到全局错误消息中，这肯定不是我们想要的，我们改造下吧。</p><p>&nbsp;</p><p>7.1、定义验证注解</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435846" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.hibernate.validator.internal.constraintvalidators.ScriptAssertValidator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Documented;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Retention;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;java.lang.annotation.Target;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.Constraint;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.Payload;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;<span class="keyword">static</span>&nbsp;java.lang.annotation.ElementType.TYPE;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;<span class="keyword">static</span>&nbsp;java.lang.annotation.RetentionPolicy.RUNTIME;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="annotation">@Target</span>({&nbsp;TYPE&nbsp;})&nbsp;&nbsp;</li><li><span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li><span class="annotation">@Constraint</span>(validatedBy&nbsp;=&nbsp;{PropertyScriptAssertValidator.<span class="keyword">class</span>})&nbsp;&nbsp;</li><li><span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">@interface</span>&nbsp;PropertyScriptAssert&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">"{org.hibernate.validator.constraints.ScriptAssert.message}"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt;[]&nbsp;groups()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&nbsp;<span class="keyword">extends</span>&nbsp;Payload&gt;[]&nbsp;payload()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;lang();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;script();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;alias()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">"_this"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;property();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Target</span>({&nbsp;TYPE&nbsp;})&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">@interface</span>&nbsp;List&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PropertyScriptAssert[]&nbsp;value();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>和ScriptAssert没什么区别，只是多了个property用来指定出错后给实体的哪个属性。</p><p>&nbsp;</p><p>7.2、验证器</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435847" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.script.ScriptException;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.ConstraintDeclarationException;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.ConstraintValidator;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;javax.validation.ConstraintValidatorContext;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;com.sishuok.spring4.validator.PropertyScriptAssert;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.hibernate.validator.constraints.ScriptAssert;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.hibernate.validator.internal.util.Contracts;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.hibernate.validator.internal.util.logging.Log;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.hibernate.validator.internal.util.logging.LoggerFactory;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.hibernate.validator.internal.util.scriptengine.ScriptEvaluator;&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;org.hibernate.validator.internal.util.scriptengine.ScriptEvaluatorFactory;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">import</span>&nbsp;<span class="keyword">static</span>&nbsp;org.hibernate.validator.internal.util.logging.Messages.MESSAGES;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;PropertyScriptAssertValidator&nbsp;<span class="keyword">implements</span>&nbsp;ConstraintValidator&lt;PropertyScriptAssert,&nbsp;Object&gt;&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;<span class="keyword">static</span>&nbsp;<span class="keyword">final</span>&nbsp;Log&nbsp;log&nbsp;=&nbsp;LoggerFactory.make();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;script;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;languageName;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;alias;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;property;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;String&nbsp;message;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">void</span>&nbsp;initialize(PropertyScriptAssert&nbsp;constraintAnnotation)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validateParameters(&nbsp;constraintAnnotation&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.script&nbsp;=&nbsp;constraintAnnotation.script();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.languageName&nbsp;=&nbsp;constraintAnnotation.lang();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.alias&nbsp;=&nbsp;constraintAnnotation.alias();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.property&nbsp;=&nbsp;constraintAnnotation.property();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span>.message&nbsp;=&nbsp;constraintAnnotation.message();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">boolean</span>&nbsp;isValid(Object&nbsp;value,&nbsp;ConstraintValidatorContext&nbsp;constraintValidatorContext)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;evaluationResult;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptEvaluator&nbsp;scriptEvaluator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span>&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ScriptEvaluatorFactory&nbsp;evaluatorFactory&nbsp;=&nbsp;ScriptEvaluatorFactory.getInstance();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scriptEvaluator&nbsp;=&nbsp;evaluatorFactory.getScriptEvaluatorByLanguageName(&nbsp;languageName&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">catch</span>&nbsp;(&nbsp;ScriptException&nbsp;e&nbsp;)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">throw</span>&nbsp;<span class="keyword">new</span>&nbsp;ConstraintDeclarationException(&nbsp;e&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span>&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;evaluationResult&nbsp;=&nbsp;scriptEvaluator.evaluate(&nbsp;script,&nbsp;value,&nbsp;alias&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">catch</span>&nbsp;(&nbsp;ScriptException&nbsp;e&nbsp;)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">throw</span>&nbsp;log.getErrorDuringScriptExecutionException(&nbsp;script,&nbsp;e&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;evaluationResult&nbsp;==&nbsp;<span class="keyword">null</span>&nbsp;)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">throw</span>&nbsp;log.getScriptMustReturnTrueOrFalseException(&nbsp;script&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;(&nbsp;!(&nbsp;evaluationResult&nbsp;<span class="keyword">instanceof</span>&nbsp;Boolean&nbsp;)&nbsp;)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">throw</span>&nbsp;log.getScriptMustReturnTrueOrFalseException(&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script,&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;evaluationResult,&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;evaluationResult.getClass().getCanonicalName()&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(Boolean.FALSE.equals(evaluationResult))&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintValidatorContext.disableDefaultConstraintViolation();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;constraintValidatorContext&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.buildConstraintViolationWithTemplate(message)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addPropertyNode(property)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addConstraintViolation();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;Boolean.TRUE.equals(&nbsp;evaluationResult&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span>&nbsp;<span class="keyword">void</span>&nbsp;validateParameters(PropertyScriptAssert&nbsp;constraintAnnotation)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contracts.assertNotEmpty(&nbsp;constraintAnnotation.script(),&nbsp;MESSAGES.parameterMustNotBeEmpty(&nbsp;<span class="string">"script"</span>&nbsp;)&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contracts.assertNotEmpty(&nbsp;constraintAnnotation.lang(),&nbsp;MESSAGES.parameterMustNotBeEmpty(&nbsp;<span class="string">"lang"</span>&nbsp;)&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contracts.assertNotEmpty(&nbsp;constraintAnnotation.alias(),&nbsp;MESSAGES.parameterMustNotBeEmpty(&nbsp;<span class="string">"alias"</span>&nbsp;)&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contracts.assertNotEmpty(&nbsp;constraintAnnotation.property(),&nbsp;MESSAGES.parameterMustNotBeEmpty(&nbsp;<span class="string">"property"</span>&nbsp;)&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contracts.assertNotEmpty(&nbsp;constraintAnnotation.message(),&nbsp;MESSAGES.parameterMustNotBeEmpty(&nbsp;<span class="string">"message"</span>&nbsp;)&nbsp;);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>和之前的类级别验证器类似，就不多解释了，其他代码全部拷贝自org.hibernate.validator.internal.constraintvalidators.ScriptAssertValidator。</p><p>&nbsp;</p><p>7.3、使用</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435848" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@PropertyScriptAssert</span>(property&nbsp;=&nbsp;<span class="string">"confirmation"</span>,&nbsp;script&nbsp;=&nbsp;<span class="string">"_this.password==_this.confirmation"</span>,&nbsp;lang&nbsp;=&nbsp;<span class="string">"javascript"</span>,&nbsp;alias&nbsp;=&nbsp;<span class="string">"_this"</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{password.confirmation.error}"</span>)&nbsp;&nbsp;</li></ol></div><p>和之前的区别就是多了个property，用来指定出错时给哪个字段。 这个相对之前的类级别验证器更通用一点。</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t7"></a>8、cross-parameter，跨参数验证</h2><p>直接看示例；</p><p>&nbsp;</p><p>8.1、首先注册MethodValidationPostProcessor，起作用请参考《<a href="http://jinnianshilongnian.iteye.com/blog/1495594" target="_blank" data-mce-href="http://jinnianshilongnian.iteye.com/blog/1495594">Spring3.1 对Bean Validation规范的新支持(方法级别验证)</a>&nbsp;》&nbsp;</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435849" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>&lt;bean&nbsp;<span class="keyword">class</span>=<span class="string">"org.springframework.validation.beanvalidation.MethodValidationPostProcessor"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"validator"</span>&nbsp;ref=<span class="string">"validator"</span>/&gt;&nbsp;&nbsp;</li><li>&lt;/bean&gt;&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>8.2、Service&nbsp;</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435850" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@Validated</span>&nbsp;&nbsp;</li><li><span class="annotation">@Service</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;UserService&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@CrossParameter</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">void</span>&nbsp;changePassword(String&nbsp;password,&nbsp;String&nbsp;confirmation)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>通过@Validated注解UserService表示该类中有需要进行方法参数/返回值验证；&nbsp;&nbsp;&nbsp;@CrossParameter注解方法表示要进行跨参数验证；即验证password和confirmation是否相等。</p><p>&nbsp;</p><p>8.3、验证注解&nbsp;</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435851" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="comment">//省略import</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="annotation">@Constraint</span>(validatedBy&nbsp;=&nbsp;CrossParameterValidator.<span class="keyword">class</span>)&nbsp;&nbsp;</li><li><span class="annotation">@Target</span>({&nbsp;METHOD,&nbsp;CONSTRUCTOR,&nbsp;ANNOTATION_TYPE&nbsp;})&nbsp;&nbsp;</li><li><span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li><span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">@interface</span>&nbsp;CrossParameter&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">"{password.confirmation.error}"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt;[]&nbsp;groups()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&nbsp;<span class="keyword">extends</span>&nbsp;Payload&gt;[]&nbsp;payload()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>8.4、验证器&nbsp;</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435852" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="comment">//省略import</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="annotation">@SupportedValidationTarget</span>(ValidationTarget.PARAMETERS)&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">class</span>&nbsp;CrossParameterValidator&nbsp;<span class="keyword">implements</span>&nbsp;ConstraintValidator&lt;CrossParameter,&nbsp;Object[]&gt;&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">void</span>&nbsp;initialize(CrossParameter&nbsp;constraintAnnotation)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@Override</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span>&nbsp;<span class="keyword">boolean</span>&nbsp;isValid(Object[]&nbsp;value,&nbsp;ConstraintValidatorContext&nbsp;context)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(value&nbsp;==&nbsp;<span class="keyword">null</span>&nbsp;||&nbsp;value.length&nbsp;!=&nbsp;<span class="number">2</span>)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">throw</span>&nbsp;<span class="keyword">new</span>&nbsp;IllegalArgumentException(<span class="string">"must&nbsp;have&nbsp;two&nbsp;args"</span>);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(value[<span class="number">0</span>]&nbsp;==&nbsp;<span class="keyword">null</span>&nbsp;||&nbsp;value[<span class="number">1</span>]&nbsp;==&nbsp;<span class="keyword">null</span>)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">true</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>(value[<span class="number">0</span>].equals(value[<span class="number">1</span>]))&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">true</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="keyword">false</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>其中@SupportedValidationTarget(ValidationTarget.PARAMETERS)表示验证参数； value将是参数列表。&nbsp;</p><p>&nbsp;</p><p>8.5、使用</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435853" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@RequestMapping</span>(<span class="string">"/changePassword"</span>)&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;String&nbsp;changePassword(&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@RequestParam</span>(<span class="string">"password"</span>)&nbsp;String&nbsp;password,&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="annotation">@RequestParam</span>(<span class="string">"confirmation"</span>)&nbsp;String&nbsp;confirmation,&nbsp;Model&nbsp;model)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span>&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userService.changePassword(password,&nbsp;confirmation);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="keyword">catch</span>&nbsp;(ConstraintViolationException&nbsp;e)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span>(ConstraintViolation&nbsp;violation&nbsp;:&nbsp;e.getConstraintViolations())&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(violation.getMessage());&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>&nbsp;<span class="string">"success"</span>;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>调用userService.changePassword方法，如果验证失败将抛出ConstraintViolationException异常，然后得到ConstraintViolation，调用getMessage即可得到错误消息；然后到前台显示即可。</p><p>&nbsp;</p><p>从以上来看，不如之前的使用方便，需要自己对错误消息进行处理。 下一节我们也写个脚本方式的跨参数验证器。</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t8"></a>9、混合类级别验证器和跨参数验证器</h2><p>9.1、验证注解</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435854" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="keyword">package</span>&nbsp;com.sishuok.spring4.validator;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="comment">//省略import</span>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li><span class="annotation">@Constraint</span>(validatedBy&nbsp;=&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CrossParameterScriptAssertClassValidator.<span class="keyword">class</span>,&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CrossParameterScriptAssertParameterValidator.<span class="keyword">class</span>&nbsp;&nbsp;</li><li>})&nbsp;&nbsp;</li><li><span class="annotation">@Target</span>({&nbsp;TYPE,&nbsp;FIELD,&nbsp;PARAMETER,&nbsp;METHOD,&nbsp;CONSTRUCTOR,&nbsp;ANNOTATION_TYPE&nbsp;})&nbsp;&nbsp;</li><li><span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li><span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">@interface</span>&nbsp;CrossParameterScriptAssert&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">"error"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt;[]&nbsp;groups()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&nbsp;<span class="keyword">extends</span>&nbsp;Payload&gt;[]&nbsp;payload()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;script();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;lang();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;alias()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">"_this"</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;property()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">""</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;ConstraintTarget&nbsp;validationAppliesTo()&nbsp;<span class="keyword">default</span>&nbsp;ConstraintTarget.IMPLICIT;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;&nbsp;</li></ol></div><p>&nbsp;</p><p>此处我们通过@Constraint指定了两个验证器，一个类级别的，一个跨参数的。validationAppliesTo指定为ConstraintTarget.IMPLICIT，表示隐式自动判断。</p><p>&nbsp;</p><p>9.2、验证器</p><p>请下载源码查看</p><p>&nbsp;</p><p>9.3、使用</p><p>9.3.1、类级别使用</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435855" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@CrossParameterScriptAssert</span>(property&nbsp;=&nbsp;<span class="string">"confirmation"</span>,&nbsp;script&nbsp;=&nbsp;<span class="string">"_this.password==_this.confirmation"</span>,&nbsp;lang&nbsp;=&nbsp;<span class="string">"javascript"</span>,&nbsp;alias&nbsp;=&nbsp;<span class="string">"_this"</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{password.confirmation.error}"</span>)&nbsp;&nbsp;</li></ol></div><p>指定property即可，其他和之前的一样。</p><p>9.3.2、跨参数验证</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435856" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@CrossParameterScriptAssert</span>(script&nbsp;=&nbsp;<span class="string">"args[0]&nbsp;==&nbsp;args[1]"</span>,&nbsp;lang&nbsp;=&nbsp;<span class="string">"javascript"</span>,&nbsp;alias&nbsp;=&nbsp;<span class="string">"args"</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{password.confirmation.error}"</span>)&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">void</span>&nbsp;changePassword(String&nbsp;password,&nbsp;String&nbsp;confirmation)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>通过args[0]==args[1] 来判断是否相等。</p><p>&nbsp;</p><p>这样，我们的验证注解就自动适应两种验证规则了。&nbsp;&nbsp;</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t9"></a>10、组合验证注解&nbsp;</h2><p>有时候，可能有好几个注解需要一起使用，此时就可以使用组合验证注解</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435857" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@Target</span>({&nbsp;FIELD})&nbsp;&nbsp;</li><li><span class="annotation">@Retention</span>(RUNTIME)&nbsp;&nbsp;</li><li><span class="annotation">@Documented</span>&nbsp;&nbsp;</li><li><span class="annotation">@NotNull</span>(message&nbsp;=&nbsp;<span class="string">"{user.name.null}"</span>)&nbsp;&nbsp;</li><li><span class="annotation">@Length</span>(min&nbsp;=&nbsp;<span class="number">5</span>,&nbsp;max&nbsp;=&nbsp;<span class="number">20</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.length.illegal}"</span>)&nbsp;&nbsp;</li><li><span class="annotation">@Pattern</span>(regexp&nbsp;=&nbsp;<span class="string">"[a-zA-Z]{5,20}"</span>,&nbsp;message&nbsp;=&nbsp;<span class="string">"{user.name.length.illegal}"</span>)&nbsp;&nbsp;</li><li><span class="annotation">@Constraint</span>(validatedBy&nbsp;=&nbsp;{&nbsp;})&nbsp;&nbsp;</li><li><span class="keyword">public</span>&nbsp;<span class="keyword">@interface</span>&nbsp;Composition&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message()&nbsp;<span class="keyword">default</span>&nbsp;<span class="string">""</span>;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt;[]&nbsp;groups()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&nbsp;<span class="keyword">extends</span>&nbsp;Payload&gt;[]&nbsp;payload()&nbsp;<span class="keyword">default</span>&nbsp;{&nbsp;};&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><p>这样我们验证时只需要：</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435858" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li><span class="annotation">@Composition</span>()&nbsp;&nbsp;</li><li><span class="keyword">private</span>&nbsp;String&nbsp;name;&nbsp;&nbsp;</li></ol></div><p>简洁多了。&nbsp;</p><p>&nbsp;</p><h2><a class="mce-item-anchor" target="_blank" name="t10"></a>11、本地化&nbsp;</h2><p>即根据不同的语言选择不同的错误消息显示。</p><p>1、本地化解析器</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435859" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>&lt;bean&nbsp;id=<span class="string">"localeResolver"</span>&nbsp;<span class="keyword">class</span>=<span class="string">"org.springframework.web.servlet.i18n.CookieLocaleResolver"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"cookieName"</span>&nbsp;value=<span class="string">"locale"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"cookieMaxAge"</span>&nbsp;value=<span class="string">"-1"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"defaultLocale"</span>&nbsp;value=<span class="string">"zh_CN"</span>/&gt;&nbsp;&nbsp;</li><li>&lt;/bean&gt;&nbsp;&nbsp;</li></ol></div><p>此处使用cookie存储本地化信息，当然也可以选择其他的，如Session存储。</p><p>&nbsp;</p><p>2、设置本地化信息的拦截器</p><div id="" class="dp-highlighter"><div class="bar"><div class="tools">Java代码&nbsp;&nbsp;<a title="收藏这段代码" target="_blank"><img id="__LEANOTE_D_IMG_1496556435860" class="star" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png" alt="收藏代码" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000007.png"></a></div></div><ol class="dp-j" start="1"><li>&lt;mvc:interceptors&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;bean&nbsp;<span class="keyword">class</span>=<span class="string">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span>&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name=<span class="string">"paramName"</span>&nbsp;value=<span class="string">"language"</span>/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/bean&gt;&nbsp;&nbsp;</li><li>&lt;/mvc:interceptors&gt;&nbsp;&nbsp;</li></ol></div><p>即请求参数中通过language设置语言。</p><p>&nbsp;</p><p>3、消息文件</p><p><img id="__LEANOTE_D_IMG_1496556435861" src="spring4.0整合了validation验证功能_files/5933a394708c693d97000004.png" alt="" data-mce-src="spring4.0整合了validation验证功能_files/5933a394708c693d97000004.png"></p><p>&nbsp;</p><p>4、 浏览器输入</p><p>http://localhost:9080/spring4/changePassword?password=1&amp;confirmation=2&amp;language=en_US</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>到此，我们已经完成大部分Bean Validation的功能实验了。对于如XML配置、编程式验证API的使用等对于我们使用SpringMVC这种web环境用处不大，所以就不多介绍了，有兴趣可以自己下载官方文档学习</p></div></div>
	</div>

<!-- 该js供其它处理 -->
<script src="../leanote-html.js"></script>
</body>
</html>